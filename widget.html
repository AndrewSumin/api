<!DOCTYPE html>
<html lang="ru-RU">
    <head>
        <title>JS API</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" type="text/css" href="style.css"/>
        <script type="text/javascript" src="api.js"></script>
    </head>
    <body>
        <div style="float:left; width:500px;">
            <div id="search"></div>
            <div class="pager">
                <a id="previous" href="javascript:void(0)">назад</a>&#160;&#160;<a id="next" href="javascript:void(0)">еще 5 вакансий</a>
            </div>
        </div>
        <div class="employer">
            <div id="employername" class="employer__name"></div>
            <div id="employer"></div>
        </div>
        <script>
            (function(){
                function log(json){
                    console.log(json);
                }
                function vacancy(vacancy){
                    vacancy.load().then(log)
                                  .fail(log)
                                  .employer.load().then(log)
                                                  .fail(log);
                           
                    return '<div class="vacancy">' + 
                               '<a href="' + vacancy.links.alternate.href + '" class="vacancy">' + vacancy.name + '</a>' + 
                               '<br/>' + 
                               '<span class="salary">' +
                                   (vacancy.salary 
                                       ? '<span class="salary__set">' + 
                                             (vacancy.salary.from
                                                 ? 'от ' + vacancy.salary.from
                                                 : '') + 
                                             (vacancy.salary.to
                                                 ? ' до ' + vacancy.salary.to
                                                 : '') + 
                                             ((vacancy.salary.from || vacancy.salary.to) && vacancy.salary.currency.name
                                                 ? ' ' + vacancy.salary.currency.name
                                                 : '') +
                                         '</span>'
                                       : '<span class="salary__notset">з/п не указанна</span>') +
                                '</span>' +
                                ' <a class="vacancy__employer" href="' + (vacancy.employer.links.alternate ? vacancy.employer.links.alternate.href : '#') + '">' + vacancy.employer.name + '</a>'+
                            '</div>';
                }
                
                function pages(pages){
                    var next = document.getElementById('next');
                    next.style.visibility = pages.isNext() ? 'visible' : 'hidden';
                    next.onclick = function(){
                        pages.next().done(result);
                    };
                    var previous = document.getElementById('previous');
                    previous.style.visibility = pages.isPrevious() ? 'visible' : 'hidden';
                    previous.onclick = function(){
                        pages.previous().done(result);
                    };
                }
                function search(response){
                    response.iterate(vacancy, function vacancies(vacancies){document.getElementById('search').innerHTML = vacancies.join('');})
                            .pages(pages);
                }
                
                hh.vacancies.search({text:'javascript'})
                            .done(search)
                            .fail(log);
                
                hh.vacancies.employer(1455)
                            .iterate(vacancy, function(vacancies){document.getElementById('employer').innerHTML = vacancies.join('');})
                            .fail(log);
                
                hh.employer(1455)
                  .then(function(employer){document.getElementById('employername').innerHTML = employer.name;});
            })();
        </script>
    </body>
</html>
